#!/bin/bash

#March 2020
#Stegger

export pythonBin="python3"

idx=0
pIdx=0

cmplUrl=""
cmplFile=""
maxServerTries=10
maxServerQueuingTime=300
asyncMode=0


progPath="`dirname \"$0\"`"
if [[ $progPath = "." ]] ; then
	progPath="" 
else
	progPath=$progPath/
fi

while [ $# -gt 0 ] ; do
   
   idx=$(($idx+1))
	
   	if [ $idx -eq 1 ] ; then
		cmplFile=$1
   	elif [ $idx -eq 2 ] ; then
		cmplUrl=$1
	elif [ $idx -eq 5 ] ; then
		asyncMode=$1
	elif [ $idx -eq 3 ] ; then
		maxServerTries=$1
	elif [ $idx -eq 4 ] ; then
		maxServerQueuingTime=$1
    else
		pIdx=$(($pIdx+1))
		cArg[$pIdx]="$1"
	fi
   	shift 1
	   
done
	
export PYTHONPATH="$progPath"../pyCmpl/lib3:$PYTHONPATH
export CMPLBINARY="$progPath"/cmpl
	
sN="$progPath"../pyCmpl/scripts/cmplOnServer.py
scriptName=$(cd "$(dirname "$sN")"; pwd)/$(basename "$sN")

$pythonBin $scriptName "$cmplFile" $cmplUrl $maxServerTries $maxServerQueuingTime $asyncMode "${cArg[1]}" "${cArg[2]}" "${cArg[3]}" "${cArg[4]}" "${cArg[5]}" "${cArg[6]}" "${cArg[7]}" "${cArg[8]}" "${cArg[9]}" "${cArg[10]}" "${cArg[11]}" "${cArg[12]}" "${cArg[13]}" "${cArg[14]}" "${cArg[15]}" "${cArg[16]}" "${cArg[17]}" "${cArg[18]}" "${cArg[19]}" "${cArg[20]}" >&1  
		
